# 5.3 InnoDB 스토리지 엔진 잠금
- InnoDB 스토리지 엔진을 MySQL에서 제공하는 잠금과는 별개로 스토리지 엔진 내부에서 레코드 기반의 잠금 방식을 탐재하고 있다.
- InnoDB는 레코드 기반의 잠금 방식 때문에 MyISAM보다는 훨씬 뛰어난 동시성 처리를 제공할 수 있다.

## 5.3.1 InnoDB 스토리지 엔진의 잠금
- InnoDB 스토리지 엔진은 레코드 기반의 잠금 기능을 제공하며, 잠금 정보가 상당히 작은 공간으로 관리되기 때문에 레코드 락이 페이지락으로, 또는 테이블 락으로 레벨업 되는 경우는 없음
-  일반 상용 DMBS와는 조금 다르게 InnoDB 스토리지 엔진에서는 레코드 락뿐만 아니라 레코드 락 사이의 간격을 잠그는 갭락이라는 것도 존재한다.
![InnoDB 잠금의 종류(점선의 레코드는 실제 존재하지 않는 레코드를 가정한 것음)](./images/InnoDB%20잠금의%20종류.png)


## 5.3.2 갭락
- 갭 락은 레코드 자체가 아니라 레코드와 레코드 사이의 간격만을 잠그는 것을 의미한다. 
- 갭 락의 역할은 레코드와 레코드 사이의 간격에 새로운 레코드가 생성되는 것을 제어하는 역할을 한다. 
- 갭 락은 그 자체보다는 넥스트 키 락의 일부로 자주 사용된다.


## 5.3.3 넥스트 키 락
- 레코드 락과 갭 락을 합쳐 놓은 형태의 잠금
- InnoDB의 갭 락이나 넥스트 키 락은 바이너리 로그에 기록되는 쿼리가 레플리카 서버에서 실행될 때 소스 서버에서 만들어 낸 결과와 동일한 결과를 만들어내도록 보장하는 것이 주 목적
- 그런데 의외로 넥스트 키 락과 갭 락으로 인해 데드락이 발생할 수 있는데 가능하다면 바이너리 로그 포맷을 ROW 형태로 하는 것이 좋다.

## 5.3.4 자동 증가 락
- MySQL에서는 자동 증가하는 숫자 값을 추출하기 위해 AUTO_INCREMENT라는 컬럼 속성을 제공한다. 
- AUTO_INCREMENT 칼럼이 사용된 테이블에 동시에 여러 레코드가 INSERT되는 경우, 저장되는 각 레코드는 중복되지 않고 저장된 순서대로 증가하는 일련번호 값을 가져야 한다. 이를 위해 InnoDB는 내부적으로 AUTO_INCREMENT 락이라고 하는 테이블 수준의 잠금을 사용한다.